digraph proposed_workflow {
  rankdir=TB
  bgcolor=transparent
  node [shape=box, style="rounded,filled", fillcolor=lightgreen]
  // edge [color=grey]

  enter [shape=plain,fillcolor=transparent]
  leave [shape=plain,fillcolor=transparent]
  enter -> id_check
  subgraph cluster_checkin {
    label="check-in station"
    bgcolor="#fbeee0"
    // id_check -> mint_vip_nft
    id_check
  }
  subgraph cluster_votingbooth {
    label="voting booth"
    bgcolor="#fbeee0"
    fill_out_ballot
    fill_out_ballot -> submit_ballot
  }
  subgraph cluster_phone {
    label="voting app"
    bgcolor="#fbeee0"
    node [fillcolor="#66ddff"] // blue
    confirm_onchain
    submit_ballot -> confirm_onchain [label="S:publish\ncyphertext"]
    confirm_onchain -> audit_or_cast
    decrypt_ballot
    audit_or_cast
    rank=same {audit_or_cast,decrypt_ballot}
    tmp1 [shape=point,style=invis]
    audit_or_cast -> tmp1 [label="V:audit"]
    tmp1 -> decrypt_ballot [label="S:publish\nnonce"]
    rank=same {audit_or_cast,tmp1,decrypt_ballot}
  }
  // TODO separate post
  // subgraph cluster_checkout {
  //   label="check-out station"
  //   mint_personal_nfts
  // }
  // subgraph cluster_dispute {
  //   label="arbitration"
  //   dispute -> open_ballot_box -> id_check
  // }
  // TODO separate post
  // subgraph cluster_verify {
  //   label="verifier app"
  //   verify_tally -> mint_verifier_nft
  // }
  id_check -> fill_out_ballot [label="S:vip"]
  // audit_or_cast -> mint_personal_nfts [label="cast"]
  tmp2 [shape=point,style=invis]
  audit_or_cast -> tmp2 [label="V:cast"]
  tmp2 -> leave [label="S:delete\nnonce"]
  decrypt_ballot -> id_check [label="V:certify"]
  decrypt_ballot -> id_check [label="V:dispute"]
  // id_check -> mint_personal_nfts [style="dashed"] // leave without voting
  // mint_personal_nfts -> verify_tally
  // mint_personal_nfts -> leave
  // mint_verifier_nft -> leave
}
