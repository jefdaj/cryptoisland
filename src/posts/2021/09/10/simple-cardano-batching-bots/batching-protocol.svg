<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.2 (0)
 -->
<!-- Title: protocol Pages: 1 -->
<svg width="848pt" height="681pt"
 viewBox="0.00 0.00 848.24 681.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 677)">
<title>protocol</title>
<g id="clust1" class="cluster">
<title>cluster_phase1</title>
<polygon fill="lightgrey" stroke="black" points="240.34,-482 240.34,-629 764.34,-629 764.34,-482 240.34,-482"/>
<text text-anchor="middle" x="502.34" y="-613.8" font-family="Times-Roman" font-size="14.00">Phase 1: announce trades in parallel</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_phase2</title>
<polygon fill="lightgrey" stroke="black" points="200.34,-179 200.34,-474 555.34,-474 555.34,-179 200.34,-179"/>
<text text-anchor="middle" x="377.84" y="-458.8" font-family="Times-Roman" font-size="14.00">Phase 2: single&#45;threaded batching auction</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_phase3</title>
<polygon fill="lightgrey" stroke="black" points="279.34,-64 279.34,-171 642.34,-171 642.34,-64 279.34,-64"/>
<text text-anchor="middle" x="460.84" y="-155.8" font-family="Times-Roman" font-size="14.00">Phase 3: finalize winning state transition</text>
</g>
<!-- Wallet1 -->
<g id="node1" class="node">
<title>Wallet1</title>
<ellipse fill="#66ddff" stroke="black" cx="327.34" cy="-655" rx="48.19" ry="18"/>
<text text-anchor="middle" x="327.34" y="-651.3" font-family="Times-Roman" font-size="14.00">Wallet1</text>
</g>
<!-- UserWallet1 -->
<g id="node15" class="node">
<title>UserWallet1</title>
<polygon fill="#66ddff" stroke="black" points="405.84,-598 248.84,-598 248.84,-562 405.84,-562 405.84,-598"/>
<text text-anchor="middle" x="327.34" y="-576.3" font-family="Times-Roman" font-size="14.00">User1 posts trade</text>
</g>
<!-- Wallet1&#45;&gt;UserWallet1 -->
<g id="edge2" class="edge">
<title>Wallet1&#45;&gt;UserWallet1</title>
<path fill="none" stroke="grey" d="M327.34,-636.7C327.34,-628.25 327.34,-617.87 327.34,-608.37"/>
<polygon fill="grey" stroke="grey" points="330.84,-608.18 327.34,-598.18 323.84,-608.18 330.84,-608.18"/>
</g>
<!-- Wallet2 -->
<g id="node2" class="node">
<title>Wallet2</title>
<ellipse fill="#66ddff" stroke="black" cx="502.34" cy="-655" rx="48.19" ry="18"/>
<text text-anchor="middle" x="502.34" y="-651.3" font-family="Times-Roman" font-size="14.00">Wallet2</text>
</g>
<!-- UserWallet2 -->
<g id="node14" class="node">
<title>UserWallet2</title>
<polygon fill="#66ddff" stroke="black" points="580.84,-598 423.84,-598 423.84,-562 580.84,-562 580.84,-598"/>
<text text-anchor="middle" x="502.34" y="-576.3" font-family="Times-Roman" font-size="14.00">User2 posts trade</text>
</g>
<!-- Wallet2&#45;&gt;UserWallet2 -->
<g id="edge3" class="edge">
<title>Wallet2&#45;&gt;UserWallet2</title>
<path fill="none" stroke="grey" d="M502.34,-636.7C502.34,-628.25 502.34,-617.87 502.34,-608.37"/>
<polygon fill="grey" stroke="grey" points="505.84,-608.18 502.34,-598.18 498.84,-608.18 505.84,-608.18"/>
</g>
<!-- Wallet3 -->
<g id="node3" class="node">
<title>Wallet3</title>
<ellipse fill="#66ddff" stroke="black" cx="677.34" cy="-655" rx="48.19" ry="18"/>
<text text-anchor="middle" x="677.34" y="-651.3" font-family="Times-Roman" font-size="14.00">Wallet3</text>
</g>
<!-- UserWallet3 -->
<g id="node13" class="node">
<title>UserWallet3</title>
<polygon fill="#66ddff" stroke="black" points="755.84,-598 598.84,-598 598.84,-562 755.84,-562 755.84,-598"/>
<text text-anchor="middle" x="677.34" y="-576.3" font-family="Times-Roman" font-size="14.00">User3 posts trade</text>
</g>
<!-- Wallet3&#45;&gt;UserWallet3 -->
<g id="edge1" class="edge">
<title>Wallet3&#45;&gt;UserWallet3</title>
<path fill="none" stroke="grey" d="M677.34,-636.7C677.34,-628.25 677.34,-617.87 677.34,-608.37"/>
<polygon fill="grey" stroke="grey" points="680.84,-608.18 677.34,-598.18 673.84,-608.18 680.84,-608.18"/>
</g>
<!-- BotWallet1 -->
<g id="node4" class="node">
<title>BotWallet1</title>
<ellipse fill="lightgreen" stroke="black" cx="64.34" cy="-508" rx="64.19" ry="18"/>
<text text-anchor="middle" x="64.34" y="-504.3" font-family="Times-Roman" font-size="14.00">BotWallet1</text>
</g>
<!-- Batch1 -->
<g id="node19" class="node">
<title>Batch1</title>
<polygon fill="lightgreen" stroke="black" points="413.84,-443 240.84,-443 240.84,-405 413.84,-405 413.84,-443"/>
<text text-anchor="middle" x="327.34" y="-427.8" font-family="Times-Roman" font-size="14.00">Bot1 bids 2 trades,</text>
<text text-anchor="middle" x="327.34" y="-412.8" font-family="Times-Roman" font-size="14.00">posts collateral</text>
</g>
<!-- BotWallet1&#45;&gt;Batch1 -->
<g id="edge11" class="edge">
<title>BotWallet1&#45;&gt;Batch1</title>
<path fill="none" stroke="grey" d="M102.9,-493.49C113.99,-489.68 126.12,-485.6 137.34,-482 176.16,-469.54 219.7,-456.41 255.3,-445.9"/>
<polygon fill="grey" stroke="grey" points="256.52,-449.19 265.12,-443.01 254.54,-442.48 256.52,-449.19"/>
</g>
<!-- BotWallet2 -->
<g id="node5" class="node">
<title>BotWallet2</title>
<ellipse fill="lightgreen" stroke="black" cx="627.34" cy="-351" rx="64.19" ry="18"/>
<text text-anchor="middle" x="627.34" y="-347.3" font-family="Times-Roman" font-size="14.00">BotWallet2</text>
</g>
<!-- Batch2 -->
<g id="node20" class="node">
<title>Batch2</title>
<polygon fill="lightgreen" stroke="black" points="546.84,-297 373.84,-297 373.84,-259 546.84,-259 546.84,-297"/>
<text text-anchor="middle" x="460.34" y="-281.8" font-family="Times-Roman" font-size="14.00">Bot2 bids 3 trades,</text>
<text text-anchor="middle" x="460.34" y="-266.8" font-family="Times-Roman" font-size="14.00">posts collateral</text>
</g>
<!-- BotWallet2&#45;&gt;Batch2 -->
<g id="edge12" class="edge">
<title>BotWallet2&#45;&gt;Batch2</title>
<path fill="none" stroke="grey" d="M593.55,-335.63C570.21,-325.71 538.71,-312.32 512.21,-301.05"/>
<polygon fill="grey" stroke="grey" points="513.27,-297.7 502.7,-297.01 510.53,-304.14 513.27,-297.7"/>
</g>
<!-- Wallet1p -->
<g id="node6" class="node">
<title>Wallet1p</title>
<ellipse fill="#66ddff" stroke="black" cx="167.34" cy="-18" rx="48.19" ry="18"/>
<text text-anchor="middle" x="167.34" y="-14.3" font-family="Times-Roman" font-size="14.00">Wallet1</text>
</g>
<!-- Wallet2p -->
<g id="node7" class="node">
<title>Wallet2p</title>
<ellipse fill="#66ddff" stroke="black" cx="281.34" cy="-18" rx="48.19" ry="18"/>
<text text-anchor="middle" x="281.34" y="-14.3" font-family="Times-Roman" font-size="14.00">Wallet2</text>
</g>
<!-- Wallet3p -->
<g id="node8" class="node">
<title>Wallet3p</title>
<ellipse fill="#66ddff" stroke="black" cx="395.34" cy="-18" rx="48.19" ry="18"/>
<text text-anchor="middle" x="395.34" y="-14.3" font-family="Times-Roman" font-size="14.00">Wallet3</text>
</g>
<!-- BotWallet1p -->
<g id="node9" class="node">
<title>BotWallet1p</title>
<ellipse fill="lightgreen" stroke="black" cx="525.34" cy="-18" rx="64.19" ry="18"/>
<text text-anchor="middle" x="525.34" y="-14.3" font-family="Times-Roman" font-size="14.00">BotWallet1</text>
</g>
<!-- BotWallet2p -->
<g id="node10" class="node">
<title>BotWallet2p</title>
<ellipse fill="lightgreen" stroke="black" cx="672.34" cy="-18" rx="64.19" ry="18"/>
<text text-anchor="middle" x="672.34" y="-14.3" font-family="Times-Roman" font-size="14.00">BotWallet2</text>
</g>
<!-- State1 -->
<g id="node11" class="node">
<title>State1</title>
<ellipse fill="#f6b657" stroke="black" cx="189.34" cy="-508" rx="42.79" ry="18"/>
<text text-anchor="middle" x="189.34" y="-504.3" font-family="Times-Roman" font-size="14.00">State1</text>
</g>
<!-- State1&#45;&gt;Batch1 -->
<g id="edge7" class="edge">
<title>State1&#45;&gt;Batch1</title>
<path fill="none" stroke="grey" d="M213.07,-492.9C233.73,-480.63 264.08,-462.59 288.31,-448.19"/>
<polygon fill="grey" stroke="grey" points="290.13,-451.19 296.93,-443.07 286.55,-445.17 290.13,-451.19"/>
</g>
<!-- State4 -->
<g id="node12" class="node">
<title>State4</title>
<ellipse fill="#f6b657" stroke="black" cx="797.34" cy="-18" rx="42.79" ry="18"/>
<text text-anchor="middle" x="797.34" y="-14.3" font-family="Times-Roman" font-size="14.00">State4</text>
</g>
<!-- Trade3 -->
<g id="node18" class="node">
<title>Trade3</title>
<ellipse fill="#f6b657" stroke="black" cx="623.34" cy="-508" rx="42.79" ry="18"/>
<text text-anchor="middle" x="623.34" y="-504.3" font-family="Times-Roman" font-size="14.00">Trade3</text>
</g>
<!-- UserWallet3&#45;&gt;Trade3 -->
<g id="edge4" class="edge">
<title>UserWallet3&#45;&gt;Trade3</title>
<path fill="none" stroke="grey" d="M664,-561.7C657.49,-553.27 649.55,-542.97 642.42,-533.73"/>
<polygon fill="grey" stroke="grey" points="645.05,-531.4 636.17,-525.62 639.5,-535.68 645.05,-531.4"/>
</g>
<!-- Trade2 -->
<g id="node17" class="node">
<title>Trade2</title>
<ellipse fill="#f6b657" stroke="black" cx="466.34" cy="-508" rx="42.79" ry="18"/>
<text text-anchor="middle" x="466.34" y="-504.3" font-family="Times-Roman" font-size="14.00">Trade2</text>
</g>
<!-- UserWallet2&#45;&gt;Trade2 -->
<g id="edge6" class="edge">
<title>UserWallet2&#45;&gt;Trade2</title>
<path fill="none" stroke="grey" d="M493.45,-561.7C489.35,-553.73 484.4,-544.1 479.85,-535.26"/>
<polygon fill="grey" stroke="grey" points="482.83,-533.4 475.14,-526.1 476.6,-536.6 482.83,-533.4"/>
</g>
<!-- Trade1 -->
<g id="node16" class="node">
<title>Trade1</title>
<ellipse fill="#f6b657" stroke="black" cx="327.34" cy="-508" rx="42.79" ry="18"/>
<text text-anchor="middle" x="327.34" y="-504.3" font-family="Times-Roman" font-size="14.00">Trade1</text>
</g>
<!-- UserWallet1&#45;&gt;Trade1 -->
<g id="edge5" class="edge">
<title>UserWallet1&#45;&gt;Trade1</title>
<path fill="none" stroke="grey" d="M327.34,-561.7C327.34,-553.98 327.34,-544.71 327.34,-536.11"/>
<polygon fill="grey" stroke="grey" points="330.84,-536.1 327.34,-526.1 323.84,-536.1 330.84,-536.1"/>
</g>
<!-- Trade1&#45;&gt;Batch1 -->
<g id="edge9" class="edge">
<title>Trade1&#45;&gt;Batch1</title>
<path fill="none" stroke="grey" d="M327.34,-489.61C327.34,-479.07 327.34,-465.36 327.34,-453.29"/>
<polygon fill="grey" stroke="grey" points="330.84,-453.22 327.34,-443.22 323.84,-453.22 330.84,-453.22"/>
</g>
<!-- Trade2&#45;&gt;Batch1 -->
<g id="edge10" class="edge">
<title>Trade2&#45;&gt;Batch1</title>
<path fill="none" stroke="grey" d="M442.45,-492.9C421.64,-480.63 391.07,-462.59 366.66,-448.19"/>
<polygon fill="grey" stroke="grey" points="368.37,-445.14 357.97,-443.07 364.81,-451.17 368.37,-445.14"/>
</g>
<!-- Trade3&#45;&gt;Batch2 -->
<g id="edge13" class="edge">
<title>Trade3&#45;&gt;Batch2</title>
<path fill="none" stroke="grey" d="M611.62,-490.6C583.72,-451.58 513.17,-352.9 479.2,-305.38"/>
<polygon fill="grey" stroke="grey" points="481.96,-303.22 473.3,-297.12 476.27,-307.29 481.96,-303.22"/>
</g>
<!-- State2 -->
<g id="node21" class="node">
<title>State2</title>
<ellipse fill="#f6b657" stroke="black" cx="380.34" cy="-351" rx="42.79" ry="18"/>
<text text-anchor="middle" x="380.34" y="-347.3" font-family="Times-Roman" font-size="14.00">State2</text>
</g>
<!-- Batch1&#45;&gt;State2 -->
<g id="edge8" class="edge">
<title>Batch1&#45;&gt;State2</title>
<path fill="none" stroke="grey" d="M340.99,-404.72C347.38,-396.16 355.08,-385.84 361.97,-376.61"/>
<polygon fill="grey" stroke="grey" points="364.83,-378.63 368.01,-368.52 359.22,-374.44 364.83,-378.63"/>
</g>
<!-- State3 -->
<g id="node22" class="node">
<title>State3</title>
<ellipse fill="#f6b657" stroke="black" cx="460.34" cy="-205" rx="42.79" ry="18"/>
<text text-anchor="middle" x="460.34" y="-201.3" font-family="Times-Roman" font-size="14.00">State3</text>
</g>
<!-- Batch2&#45;&gt;State3 -->
<g id="edge15" class="edge">
<title>Batch2&#45;&gt;State3</title>
<path fill="none" stroke="grey" d="M460.34,-258.72C460.34,-250.97 460.34,-241.79 460.34,-233.27"/>
<polygon fill="grey" stroke="grey" points="463.84,-233 460.34,-223 456.84,-233 463.84,-233"/>
</g>
<!-- State2&#45;&gt;Batch2 -->
<g id="edge14" class="edge">
<title>State2&#45;&gt;Batch2</title>
<path fill="none" stroke="grey" d="M398.1,-334.24C408.12,-325.35 420.88,-314.03 432.23,-303.95"/>
<polygon fill="grey" stroke="grey" points="434.66,-306.48 439.81,-297.22 430.01,-301.24 434.66,-306.48"/>
</g>
<!-- Finalize -->
<g id="node23" class="node">
<title>Finalize</title>
<polygon fill="lightgreen" stroke="black" points="604.84,-140 315.84,-140 315.84,-72 604.84,-72 604.84,-140"/>
<text text-anchor="middle" x="460.34" y="-124.8" font-family="Times-Roman" font-size="14.00">Bot2 applies all 3 trades,</text>
<text text-anchor="middle" x="460.34" y="-109.8" font-family="Times-Roman" font-size="14.00">slashes Bot1 for omitting Trade3,</text>
<text text-anchor="middle" x="460.34" y="-94.8" font-family="Times-Roman" font-size="14.00">rewards itself,</text>
<text text-anchor="middle" x="460.34" y="-79.8" font-family="Times-Roman" font-size="14.00">distributes traded tokens</text>
</g>
<!-- State3&#45;&gt;Finalize -->
<g id="edge16" class="edge">
<title>State3&#45;&gt;Finalize</title>
<path fill="none" stroke="grey" d="M460.34,-186.66C460.34,-176.51 460.34,-163.21 460.34,-150.39"/>
<polygon fill="grey" stroke="grey" points="463.84,-150.28 460.34,-140.28 456.84,-150.28 463.84,-150.28"/>
</g>
<!-- Finalize&#45;&gt;Wallet1p -->
<g id="edge17" class="edge">
<title>Finalize&#45;&gt;Wallet1p</title>
<path fill="none" stroke="grey" d="M346.87,-71.96C308,-60.61 264.26,-47.79 224.34,-36 220.82,-34.96 217.17,-33.88 213.51,-32.79"/>
<polygon fill="grey" stroke="grey" points="214.41,-29.41 203.82,-29.91 212.41,-36.12 214.41,-29.41"/>
</g>
<!-- Finalize&#45;&gt;Wallet2p -->
<g id="edge18" class="edge">
<title>Finalize&#45;&gt;Wallet2p</title>
<path fill="none" stroke="grey" d="M391.65,-72C367.03,-60.17 340.18,-47.27 319.14,-37.16"/>
<polygon fill="grey" stroke="grey" points="320.43,-33.9 309.91,-32.72 317.4,-40.21 320.43,-33.9"/>
</g>
<!-- Finalize&#45;&gt;Wallet3p -->
<g id="edge19" class="edge">
<title>Finalize&#45;&gt;Wallet3p</title>
<path fill="none" stroke="grey" d="M435.4,-72C428.24,-62.52 420.56,-52.36 413.86,-43.49"/>
<polygon fill="grey" stroke="grey" points="416.6,-41.32 407.78,-35.45 411.02,-45.54 416.6,-41.32"/>
</g>
<!-- Finalize&#45;&gt;BotWallet1p -->
<g id="edge20" class="edge">
<title>Finalize&#45;&gt;BotWallet1p</title>
<path fill="none" stroke="grey" d="M485.29,-72C492.27,-62.76 499.74,-52.87 506.32,-44.17"/>
<polygon fill="grey" stroke="grey" points="509.31,-46.01 512.55,-35.93 503.73,-41.79 509.31,-46.01"/>
</g>
<!-- Finalize&#45;&gt;BotWallet2p -->
<g id="edge21" class="edge">
<title>Finalize&#45;&gt;BotWallet2p</title>
<path fill="none" stroke="grey" d="M541.7,-72C570.98,-60.12 602.91,-47.17 627.87,-37.04"/>
<polygon fill="grey" stroke="grey" points="629.48,-40.17 637.43,-33.17 626.84,-33.68 629.48,-40.17"/>
</g>
<!-- Finalize&#45;&gt;State4 -->
<g id="edge22" class="edge">
<title>Finalize&#45;&gt;State4</title>
<path fill="none" stroke="grey" d="M605.17,-72.26C650.27,-61.44 700.05,-48.87 745.34,-36 748.64,-35.06 752.04,-34.05 755.45,-33.01"/>
<polygon fill="grey" stroke="grey" points="756.52,-36.34 765.01,-30.01 754.42,-29.66 756.52,-36.34"/>
</g>
</g>
</svg>
