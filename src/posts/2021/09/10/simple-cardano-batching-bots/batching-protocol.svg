<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.47.2 (0)
 -->
<!-- Title: protocol Pages: 1 -->
<svg width="833pt" height="717pt"
 viewBox="0.00 0.00 833.24 717.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 713)">
<title>protocol</title>
<g id="clust1" class="cluster">
<title>cluster_phase1</title>
<polygon fill="lightgrey" stroke="black" points="240.34,-482 240.34,-701 764.34,-701 764.34,-482 240.34,-482"/>
<text text-anchor="middle" x="502.34" y="-685.8" font-family="Times-Roman" font-size="14.00">Phase 1: announce trades in parallel</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_phase2</title>
<polygon fill="lightgrey" stroke="black" points="185.34,-179 185.34,-474 540.34,-474 540.34,-179 185.34,-179"/>
<text text-anchor="middle" x="362.84" y="-458.8" font-family="Times-Roman" font-size="14.00">Phase 2: single&#45;threaded batching auction</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_phase3</title>
<polygon fill="lightgrey" stroke="black" points="264.34,-64 264.34,-171 627.34,-171 627.34,-64 264.34,-64"/>
<text text-anchor="middle" x="445.84" y="-155.8" font-family="Times-Roman" font-size="14.00">Phase 3: finalize winning state transition</text>
</g>
<!-- Wallet2 -->
<g id="node1" class="node">
<title>Wallet2</title>
<ellipse fill="#66ddff" stroke="black" cx="502.34" cy="-652" rx="48.19" ry="18"/>
<text text-anchor="middle" x="502.34" y="-648.3" font-family="Times-Roman" font-size="14.00">Wallet2</text>
</g>
<!-- UserWallet2 -->
<g id="node15" class="node">
<title>UserWallet2</title>
<polygon fill="#66ddff" stroke="black" points="580.84,-598 423.84,-598 423.84,-562 580.84,-562 580.84,-598"/>
<text text-anchor="middle" x="502.34" y="-576.3" font-family="Times-Roman" font-size="14.00">User2 posts trade</text>
</g>
<!-- Wallet2&#45;&gt;UserWallet2 -->
<g id="edge5" class="edge">
<title>Wallet2&#45;&gt;UserWallet2</title>
<path fill="none" stroke="grey" d="M502.34,-633.7C502.34,-625.98 502.34,-616.71 502.34,-608.11"/>
<polygon fill="grey" stroke="grey" points="505.84,-608.1 502.34,-598.1 498.84,-608.1 505.84,-608.1"/>
</g>
<!-- Wallet1 -->
<g id="node2" class="node">
<title>Wallet1</title>
<ellipse fill="#66ddff" stroke="black" cx="327.34" cy="-652" rx="48.19" ry="18"/>
<text text-anchor="middle" x="327.34" y="-648.3" font-family="Times-Roman" font-size="14.00">Wallet1</text>
</g>
<!-- UserWallet1 -->
<g id="node13" class="node">
<title>UserWallet1</title>
<polygon fill="#66ddff" stroke="black" points="405.84,-598 248.84,-598 248.84,-562 405.84,-562 405.84,-598"/>
<text text-anchor="middle" x="327.34" y="-576.3" font-family="Times-Roman" font-size="14.00">User1 posts trade</text>
</g>
<!-- Wallet1&#45;&gt;UserWallet1 -->
<g id="edge3" class="edge">
<title>Wallet1&#45;&gt;UserWallet1</title>
<path fill="none" stroke="grey" d="M327.34,-633.7C327.34,-625.98 327.34,-616.71 327.34,-608.11"/>
<polygon fill="grey" stroke="grey" points="330.84,-608.1 327.34,-598.1 323.84,-608.1 330.84,-608.1"/>
</g>
<!-- Wallet3 -->
<g id="node3" class="node">
<title>Wallet3</title>
<ellipse fill="#66ddff" stroke="black" cx="677.34" cy="-652" rx="48.19" ry="18"/>
<text text-anchor="middle" x="677.34" y="-648.3" font-family="Times-Roman" font-size="14.00">Wallet3</text>
</g>
<!-- UserWallet3 -->
<g id="node14" class="node">
<title>UserWallet3</title>
<polygon fill="#66ddff" stroke="black" points="755.84,-598 598.84,-598 598.84,-562 755.84,-562 755.84,-598"/>
<text text-anchor="middle" x="677.34" y="-576.3" font-family="Times-Roman" font-size="14.00">User3 posts trade</text>
</g>
<!-- Wallet3&#45;&gt;UserWallet3 -->
<g id="edge1" class="edge">
<title>Wallet3&#45;&gt;UserWallet3</title>
<path fill="none" stroke="grey" d="M677.34,-633.7C677.34,-625.98 677.34,-616.71 677.34,-608.11"/>
<polygon fill="grey" stroke="grey" points="680.84,-608.1 677.34,-598.1 673.84,-608.1 680.84,-608.1"/>
</g>
<!-- BotWallet1 -->
<g id="node4" class="node">
<title>BotWallet1</title>
<ellipse fill="lightgreen" stroke="black" cx="64.34" cy="-508" rx="64.19" ry="18"/>
<text text-anchor="middle" x="64.34" y="-504.3" font-family="Times-Roman" font-size="14.00">BotWallet1</text>
</g>
<!-- Batch1 -->
<g id="node19" class="node">
<title>Batch1</title>
<polygon fill="lightgreen" stroke="black" points="388.84,-443 215.84,-443 215.84,-405 388.84,-405 388.84,-443"/>
<text text-anchor="middle" x="302.34" y="-427.8" font-family="Times-Roman" font-size="14.00">Bot1 bids 2 trades,</text>
<text text-anchor="middle" x="302.34" y="-412.8" font-family="Times-Roman" font-size="14.00">posts collateral</text>
</g>
<!-- BotWallet1&#45;&gt;Batch1 -->
<g id="edge7" class="edge">
<title>BotWallet1&#45;&gt;Batch1</title>
<path fill="none" stroke="grey" d="M103.38,-493.55C140.53,-480.75 197.03,-461.29 240.34,-446.36"/>
<polygon fill="grey" stroke="grey" points="241.61,-449.63 249.92,-443.06 239.33,-443.01 241.61,-449.63"/>
</g>
<!-- BotWallet2 -->
<g id="node5" class="node">
<title>BotWallet2</title>
<ellipse fill="lightgreen" stroke="black" cx="612.34" cy="-351" rx="64.19" ry="18"/>
<text text-anchor="middle" x="612.34" y="-347.3" font-family="Times-Roman" font-size="14.00">BotWallet2</text>
</g>
<!-- Batch2 -->
<g id="node20" class="node">
<title>Batch2</title>
<polygon fill="lightgreen" stroke="black" points="531.84,-297 358.84,-297 358.84,-259 531.84,-259 531.84,-297"/>
<text text-anchor="middle" x="445.34" y="-281.8" font-family="Times-Roman" font-size="14.00">Bot2 bids 3 trades,</text>
<text text-anchor="middle" x="445.34" y="-266.8" font-family="Times-Roman" font-size="14.00">posts collateral</text>
</g>
<!-- BotWallet2&#45;&gt;Batch2 -->
<g id="edge12" class="edge">
<title>BotWallet2&#45;&gt;Batch2</title>
<path fill="none" stroke="grey" d="M578.55,-335.63C555.21,-325.71 523.71,-312.32 497.21,-301.05"/>
<polygon fill="grey" stroke="grey" points="498.27,-297.7 487.7,-297.01 495.53,-304.14 498.27,-297.7"/>
</g>
<!-- Wallet1p -->
<g id="node6" class="node">
<title>Wallet1p</title>
<ellipse fill="#66ddff" stroke="black" cx="152.34" cy="-18" rx="48.19" ry="18"/>
<text text-anchor="middle" x="152.34" y="-14.3" font-family="Times-Roman" font-size="14.00">Wallet1</text>
</g>
<!-- Wallet2p -->
<g id="node7" class="node">
<title>Wallet2p</title>
<ellipse fill="#66ddff" stroke="black" cx="266.34" cy="-18" rx="48.19" ry="18"/>
<text text-anchor="middle" x="266.34" y="-14.3" font-family="Times-Roman" font-size="14.00">Wallet2</text>
</g>
<!-- Wallet3p -->
<g id="node8" class="node">
<title>Wallet3p</title>
<ellipse fill="#66ddff" stroke="black" cx="380.34" cy="-18" rx="48.19" ry="18"/>
<text text-anchor="middle" x="380.34" y="-14.3" font-family="Times-Roman" font-size="14.00">Wallet3</text>
</g>
<!-- BotWallet1p -->
<g id="node9" class="node">
<title>BotWallet1p</title>
<ellipse fill="lightgreen" stroke="black" cx="510.34" cy="-18" rx="64.19" ry="18"/>
<text text-anchor="middle" x="510.34" y="-14.3" font-family="Times-Roman" font-size="14.00">BotWallet1</text>
</g>
<!-- BotWallet2p -->
<g id="node10" class="node">
<title>BotWallet2p</title>
<ellipse fill="lightgreen" stroke="black" cx="657.34" cy="-18" rx="64.19" ry="18"/>
<text text-anchor="middle" x="657.34" y="-14.3" font-family="Times-Roman" font-size="14.00">BotWallet2</text>
</g>
<!-- State4 -->
<g id="node11" class="node">
<title>State4</title>
<ellipse fill="#f6b657" stroke="black" cx="782.34" cy="-18" rx="42.79" ry="18"/>
<text text-anchor="middle" x="782.34" y="-14.3" font-family="Times-Roman" font-size="14.00">State4</text>
</g>
<!-- State1 -->
<g id="node12" class="node">
<title>State1</title>
<ellipse fill="#f6b657" stroke="black" cx="189.34" cy="-508" rx="42.79" ry="18"/>
<text text-anchor="middle" x="189.34" y="-504.3" font-family="Times-Roman" font-size="14.00">State1</text>
</g>
<!-- State1&#45;&gt;Batch1 -->
<g id="edge10" class="edge">
<title>State1&#45;&gt;Batch1</title>
<path fill="none" stroke="grey" d="M209.81,-492.15C226.32,-480.17 249.87,-463.08 269.09,-449.13"/>
<polygon fill="grey" stroke="grey" points="271.26,-451.88 277.29,-443.18 267.14,-446.22 271.26,-451.88"/>
</g>
<!-- Trade1 -->
<g id="node16" class="node">
<title>Trade1</title>
<ellipse fill="#f6b657" stroke="black" cx="327.34" cy="-508" rx="42.79" ry="18"/>
<text text-anchor="middle" x="327.34" y="-504.3" font-family="Times-Roman" font-size="14.00">Trade1</text>
</g>
<!-- UserWallet1&#45;&gt;Trade1 -->
<g id="edge4" class="edge">
<title>UserWallet1&#45;&gt;Trade1</title>
<path fill="none" stroke="grey" d="M327.34,-561.7C327.34,-553.98 327.34,-544.71 327.34,-536.11"/>
<polygon fill="grey" stroke="grey" points="330.84,-536.1 327.34,-526.1 323.84,-536.1 330.84,-536.1"/>
</g>
<!-- Trade3 -->
<g id="node18" class="node">
<title>Trade3</title>
<ellipse fill="#f6b657" stroke="black" cx="618.34" cy="-508" rx="42.79" ry="18"/>
<text text-anchor="middle" x="618.34" y="-504.3" font-family="Times-Roman" font-size="14.00">Trade3</text>
</g>
<!-- UserWallet3&#45;&gt;Trade3 -->
<g id="edge2" class="edge">
<title>UserWallet3&#45;&gt;Trade3</title>
<path fill="none" stroke="grey" d="M662.76,-561.7C655.48,-553.05 646.54,-542.46 638.61,-533.04"/>
<polygon fill="grey" stroke="grey" points="641.07,-530.54 631.95,-525.14 635.72,-535.05 641.07,-530.54"/>
</g>
<!-- Trade2 -->
<g id="node17" class="node">
<title>Trade2</title>
<ellipse fill="#f6b657" stroke="black" cx="455.34" cy="-508" rx="42.79" ry="18"/>
<text text-anchor="middle" x="455.34" y="-504.3" font-family="Times-Roman" font-size="14.00">Trade2</text>
</g>
<!-- UserWallet2&#45;&gt;Trade2 -->
<g id="edge6" class="edge">
<title>UserWallet2&#45;&gt;Trade2</title>
<path fill="none" stroke="grey" d="M490.73,-561.7C485.12,-553.35 478.3,-543.18 472.14,-534.02"/>
<polygon fill="grey" stroke="grey" points="474.99,-531.97 466.5,-525.62 469.17,-535.88 474.99,-531.97"/>
</g>
<!-- Trade1&#45;&gt;Batch1 -->
<g id="edge8" class="edge">
<title>Trade1&#45;&gt;Batch1</title>
<path fill="none" stroke="grey" d="M322.16,-490.01C318.9,-479.31 314.61,-465.24 310.86,-452.92"/>
<polygon fill="grey" stroke="grey" points="314.13,-451.65 307.86,-443.11 307.43,-453.69 314.13,-451.65"/>
</g>
<!-- Trade1&#45;&gt;Batch2 -->
<g id="edge13" class="edge">
<title>Trade1&#45;&gt;Batch2</title>
<path fill="none" stroke="grey" d="M362.87,-497.63C375.73,-492.58 389.3,-485.04 398.34,-474 419.16,-448.58 434.83,-354.66 441.63,-307.05"/>
<polygon fill="grey" stroke="grey" points="445.1,-307.48 443.01,-297.1 438.17,-306.52 445.1,-307.48"/>
</g>
<!-- Trade2&#45;&gt;Batch1 -->
<g id="edge9" class="edge">
<title>Trade2&#45;&gt;Batch1</title>
<path fill="none" stroke="grey" d="M429.74,-493.28C406.65,-480.9 372.26,-462.47 345.03,-447.88"/>
<polygon fill="grey" stroke="grey" points="346.56,-444.73 336.09,-443.09 343.25,-450.9 346.56,-444.73"/>
</g>
<!-- Trade2&#45;&gt;Batch2 -->
<g id="edge14" class="edge">
<title>Trade2&#45;&gt;Batch2</title>
<path fill="none" stroke="grey" d="M454.59,-489.86C452.88,-450.87 448.69,-355.19 446.58,-307.29"/>
<polygon fill="grey" stroke="grey" points="450.08,-307.12 446.15,-297.28 443.09,-307.43 450.08,-307.12"/>
</g>
<!-- Trade3&#45;&gt;Batch2 -->
<g id="edge15" class="edge">
<title>Trade3&#45;&gt;Batch2</title>
<path fill="none" stroke="grey" d="M605.9,-490.6C576.29,-451.58 501.42,-352.9 465.36,-305.38"/>
<polygon fill="grey" stroke="grey" points="467.93,-302.97 459.1,-297.12 462.35,-307.21 467.93,-302.97"/>
</g>
<!-- State2 -->
<g id="node21" class="node">
<title>State2</title>
<ellipse fill="#f6b657" stroke="black" cx="324.34" cy="-351" rx="42.79" ry="18"/>
<text text-anchor="middle" x="324.34" y="-347.3" font-family="Times-Roman" font-size="14.00">State2</text>
</g>
<!-- Batch1&#45;&gt;State2 -->
<g id="edge11" class="edge">
<title>Batch1&#45;&gt;State2</title>
<path fill="none" stroke="grey" d="M308.01,-404.72C310.46,-396.8 313.38,-387.38 316.07,-378.71"/>
<polygon fill="grey" stroke="grey" points="319.46,-379.59 319.08,-369 312.77,-377.52 319.46,-379.59"/>
</g>
<!-- State3 -->
<g id="node22" class="node">
<title>State3</title>
<ellipse fill="#f6b657" stroke="black" cx="445.34" cy="-205" rx="42.79" ry="18"/>
<text text-anchor="middle" x="445.34" y="-201.3" font-family="Times-Roman" font-size="14.00">State3</text>
</g>
<!-- Batch2&#45;&gt;State3 -->
<g id="edge17" class="edge">
<title>Batch2&#45;&gt;State3</title>
<path fill="none" stroke="grey" d="M445.34,-258.72C445.34,-250.97 445.34,-241.79 445.34,-233.27"/>
<polygon fill="grey" stroke="grey" points="448.84,-233 445.34,-223 441.84,-233 448.84,-233"/>
</g>
<!-- State2&#45;&gt;Batch2 -->
<g id="edge16" class="edge">
<title>State2&#45;&gt;Batch2</title>
<path fill="none" stroke="grey" d="M348.25,-335.97C364.66,-326.34 386.82,-313.34 405.83,-302.18"/>
<polygon fill="grey" stroke="grey" points="407.74,-305.13 414.59,-297.05 404.19,-299.09 407.74,-305.13"/>
</g>
<!-- Finalize -->
<g id="node23" class="node">
<title>Finalize</title>
<polygon fill="lightgreen" stroke="black" points="589.84,-140 300.84,-140 300.84,-72 589.84,-72 589.84,-140"/>
<text text-anchor="middle" x="445.34" y="-124.8" font-family="Times-Roman" font-size="14.00">Bot2 applies all 3 trades,</text>
<text text-anchor="middle" x="445.34" y="-109.8" font-family="Times-Roman" font-size="14.00">slashes Bot1 for omitting Trade3,</text>
<text text-anchor="middle" x="445.34" y="-94.8" font-family="Times-Roman" font-size="14.00">rewards itself,</text>
<text text-anchor="middle" x="445.34" y="-79.8" font-family="Times-Roman" font-size="14.00">distributes traded tokens</text>
</g>
<!-- State3&#45;&gt;Finalize -->
<g id="edge18" class="edge">
<title>State3&#45;&gt;Finalize</title>
<path fill="none" stroke="grey" d="M445.34,-186.66C445.34,-176.51 445.34,-163.21 445.34,-150.39"/>
<polygon fill="grey" stroke="grey" points="448.84,-150.28 445.34,-140.28 441.84,-150.28 448.84,-150.28"/>
</g>
<!-- Finalize&#45;&gt;Wallet1p -->
<g id="edge19" class="edge">
<title>Finalize&#45;&gt;Wallet1p</title>
<path fill="none" stroke="grey" d="M331.87,-71.96C293,-60.61 249.26,-47.79 209.34,-36 205.82,-34.96 202.17,-33.88 198.51,-32.79"/>
<polygon fill="grey" stroke="grey" points="199.41,-29.41 188.82,-29.91 197.41,-36.12 199.41,-29.41"/>
</g>
<!-- Finalize&#45;&gt;Wallet2p -->
<g id="edge20" class="edge">
<title>Finalize&#45;&gt;Wallet2p</title>
<path fill="none" stroke="grey" d="M376.65,-72C352.03,-60.17 325.18,-47.27 304.14,-37.16"/>
<polygon fill="grey" stroke="grey" points="305.43,-33.9 294.91,-32.72 302.4,-40.21 305.43,-33.9"/>
</g>
<!-- Finalize&#45;&gt;Wallet3p -->
<g id="edge21" class="edge">
<title>Finalize&#45;&gt;Wallet3p</title>
<path fill="none" stroke="grey" d="M420.4,-72C413.24,-62.52 405.56,-52.36 398.86,-43.49"/>
<polygon fill="grey" stroke="grey" points="401.6,-41.32 392.78,-35.45 396.02,-45.54 401.6,-41.32"/>
</g>
<!-- Finalize&#45;&gt;BotWallet1p -->
<g id="edge22" class="edge">
<title>Finalize&#45;&gt;BotWallet1p</title>
<path fill="none" stroke="grey" d="M470.29,-72C477.27,-62.76 484.74,-52.87 491.32,-44.17"/>
<polygon fill="grey" stroke="grey" points="494.31,-46.01 497.55,-35.93 488.73,-41.79 494.31,-46.01"/>
</g>
<!-- Finalize&#45;&gt;BotWallet2p -->
<g id="edge23" class="edge">
<title>Finalize&#45;&gt;BotWallet2p</title>
<path fill="none" stroke="grey" d="M526.7,-72C555.98,-60.12 587.91,-47.17 612.87,-37.04"/>
<polygon fill="grey" stroke="grey" points="614.48,-40.17 622.43,-33.17 611.84,-33.68 614.48,-40.17"/>
</g>
<!-- Finalize&#45;&gt;State4 -->
<g id="edge24" class="edge">
<title>Finalize&#45;&gt;State4</title>
<path fill="none" stroke="grey" d="M590.17,-72.26C635.27,-61.44 685.05,-48.87 730.34,-36 733.64,-35.06 737.04,-34.05 740.45,-33.01"/>
<polygon fill="grey" stroke="grey" points="741.52,-36.34 750.01,-30.01 739.42,-29.66 741.52,-36.34"/>
</g>
</g>
</svg>
